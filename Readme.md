# 小鹤音形输入法Linux平台自动部署项目介绍

## 简介

本项目旨在为 Linux 系统用户解决这些关于小鹤音形输入法的需求：一是应对因系统更新或输入法重装导致的小鹤音形输入法配置文件丢失问题，二是自动部署小鹤音形输入法。通过提供自动化配置文件管理和部署工具，用户可以轻松恢复和维护其个性化输入法设置。

## 程序用法

安装过程包括以下步骤：


1. 准备好默认的配置文件压缩包`小鹤音形“鼠须管”for macOS.zip`，该文件应该从小鹤音形官网[下载](https://flypy.cc/download/)。
2. 将可执行文件比如`flyrs`，放到该配置文件压缩包所在的路径里执行，或者在执行该可执行文件时，指定该配置文件压缩包的路径。
3. 安装过程需要提权，用户需要及时输入密码。
4. 程序若执行成功，用户应重新部署输入法，以使新的配置生效。
5. 程序若执行失败，可以自行查看日志文件，了解原因，解决问题。（下详。）

### 1. 准备工作

将小鹤音形配置文件压缩包（默认名称为`小鹤音形“鼠须管”for macOS.zip`），放置在以下位置之一：

- 与安装程序同一目录（默认位置）
- 其他目录（需在运行时指定路径）

### 2. 运行安装程序

```bash
# 使用默认压缩包（当前目录下的"小鹤音形“鼠须管”for macOS.zip"）
./flyrs

# 使用指定路径的压缩包
./flyrs /path/to/your/package.zip
```

### 3. 输入法框架处理

- 程序会自动检测系统中是否已安装fcitx5、fcitx5-rime或ibus-rime
- 如果未检测到任何输入法框架，程序会**默认安装fcitx5-rime**
- 安装过程中需要输入管理员密码

### 4. 安装过程

程序将执行以下操作：
1. 初始化日志系统（日志保存在`logs/`目录）
2. 检查并安装7z和rsync等工具
3. 检查并安装输入法框架（默认fcitx5-rime）
4. 解压配置文件到`./extracted`目录
5. 备份现有Rime配置（如果有）
6. 复制新配置到系统目录`/usr/share/rime-data`
7. 设置文件权限

## 注意事项

1. **压缩包要求**：
   - 必须是有效的ZIP压缩文件
   - 建议使用官方提供的"小鹤音形“鼠须管”for macOS.zip"
   - 压缩包内应包含Rime配置文件

2. **输入法框架**：
   - 默认安装fcitx5-rime框架
   - 如果系统已安装ibus-rime，程序会识别并使用
   - 安装过程中可能需要网络连接以下载软件包

3. **权限要求**：
   - 安装过程中需要管理员权限（sudo）
   - 程序会在需要时提示输入密码

4. **备份机制**：
   - 现有配置会备份到`/usr/share/rime-backup-<时间戳>`
   - 如需恢复，可手动替换回原目录

5. **日志文件**：
   - 详细日志保存在`logs/rime_install_<时间戳>.log`
   - 安装失败时可查看此文件排查问题

6. **个人词库**：
  - 个人词库需要自己复制过去，本程序不支持自动化处理个人词库。

## 卸载说明

目前没有提供自动卸载脚本，如需卸载：
1. 删除系统目录：`sudo rm -rf /usr/share/rime-data`
2. 恢复备份（如果有）：`sudo mv /usr/share/rime-backup-<时间戳> /usr/share/rime-data`
3. 移除输入法框架（可选）：`sudo apt remove fcitx5-rime`（根据发行版调整命令）

## 项目优势

- 自动化部署：一键完成配置文件的获取、解压、安装和权限设置
- 多系统支持：兼容多种 Linux 发行版及其包管理工具
- 数据安全：操作前自动创建备份，随时可恢复旧配置
- 日志完善：完善的错误捕获和日志记录机制，方便问题排查
- 使用便捷：提供清晰的安装指南和操作提示
